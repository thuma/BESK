<h1 class="text-center">Volont√§rer</h1>
<form  v-if="edit==''" method="post" @submit="check_send" action="/api/volontarer">
    <table class="table table-sm">
      <thead>
        <tr>
          <th scope="col">
                <select v-model:value="val_kodstuga" class="form-control">
                    <option value="alla">Visa alla kodstugor</option>
                    <option v-for="kodstuga in kodstugor" v-bind:value="kodstuga.id">{{kodstuga.namn}}</option>
                </select>
          </th>
          <th scope="col">Roller</th>
          <th scope="col">Namn</th>
          <th scope="col">E-Post</th>
          <th scope="col">Telefon</th>
          <th scope="col" v-if="me.admin">V√§lj</th>
          <th scope="col">Redigera</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="volont√§r in volont√§rer" v-if="volont√§r.kodstugor_id.indexOf(val_kodstuga) > -1 || val_kodstuga=='alla'">
            <td>{{kodstuga_names_by_ids(volont√§r.kodstugor_id)}}</td>
            <td>{{volont√§r.roller.join(", ")}}</td>
            <td>{{volont√§r.namn}}</td>
            <td>{{volont√§r.epost}}</td>
            <td>{{volont√§r.telefon}}</td>
            <td v-if="me.admin"><input type="checkbox" name="flytta" v-bind:value="volont√§r.id" v-model="volont√§r.selected"></td>
            <td v-if="me.admin || volont√§r.epost == me.epost"><button type="button" class="btn btn-sm btn-outline-secondary"
                v-on:click="edit={'type':'volont√§r','data':copy(volont√§r)}">üñä</button>
            </td>
            <td v-else="">
            </td>
        </tr>
      </tbody>
    </table>
    <div class="row" v-if="me.admin">
        <div class="col-sm">
            <button 
            class="btn btn-primary"
            v-if="edit==''"
            v-on:click="edit={'type':'volont√§r','data':{'id':'','namn':'','epost':'','telefon':'','kodstugor_id':[],'roller':[]}}"
            type="button">
                Skapa ny
            </button>
        </div>
        <div class="col-sm">
            <div class="input-group">
                <div class="input-group-prepend">
                    <button class="btn btn-primary">L√§gg till valda volont√§rer till kodstugan:</button>
                </div>
                <select name="kodstugor_id" class="custom-select">
                    <option v-for="kodstuga in kodstugor" v-bind:value="kodstuga.id">{{kodstuga.namn}}</option>
                </select>
            </div>
        </div>
    </div>
</form>
<form  v-if="edit=='' && me.admin" method="post" @submit="check_send" action="/api/volontarer">
    <h1 class="text-center">Volont√§rer som finns p√• Slack men inte i BESK</h1>
    <table class="table table-sm">
      <thead>
        <tr>
          <th scope="col">Namn</th>
          <th scope="col">E-Post</th>
          <th scope="col">Telefon</th>
          <th scope="col">V√§lj</th>
          <th scope="col">L√§gg till</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="volont√§r in volont√§rer_slack" v-if="!volont√§r_finns(volont√§r.epost)">
            <td>{{volont√§r.namn}}</td>
            <td>{{volont√§r.epost}}</td>
            <td>{{volont√§r.telefon}}</td>
            <td>
                <input type="checkbox" name="groupadd" v-model:value="volont√§r.besk_id" v-model="volont√§r.selected">
                <input v-if="volont√§r.selected" type="hidden" name="namn" v-model:value="volont√§r.namn">
                <input v-if="volont√§r.selected" type="hidden" name="epost" v-model:value="volont√§r.epost">
                <input v-if="volont√§r.selected" type="hidden" name="telefon" v-model:value="volont√§r.telefon">
                <input v-if="volont√§r.selected" type="hidden" name="utdrag_datum" value="1970-01-01">
            </td>
            <td>
                <button
                    type="button" 
                    class="btn btn-sm btn-secondary"
                    v-on:click="edit={'type':'volont√§r','data':{'utdrag_datum':'1970-01-01','id':'','namn':volont√§r.namn,'epost':volont√§r.epost,'telefon':volont√§r.telefon,'kodstugor_id':[],'roller':[]}}">
                    L√§gg till i BESK
                </button>
            </td>
        </tr>
      </tbody>
    </table>
    <div class="input-group">
        <div class="input-group-prepend">
            <button class="btn btn-primary">Importera valda volont√§rer till kodstugan:</button>
            <input type="hidden" value="ja" name="flera">
        </div>
        <select name="kodstugor_id" class="custom-select">
            <option v-for="kodstuga in kodstugor" v-bind:value="kodstuga.id">{{kodstuga.namn}}</option>
        </select>
    </div>
</form>
<div v-if="edit.type=='volont√§r'" class="card">
    <div class="card-body">
        <form method="post" @submit="check_send" action="/api/volontarer">
            <input name="id" v-if="edit.data.id!==''"v-bind:value="edit.data.id" type="hidden">
            <div class="form-group">
                <label>Namn</label>
                <input
                    name="namn"
                    v-model:value="edit.data.namn"
                    type="text"
                    required=""
                    class="form-control">
            </div>
            <div class="form-group" v-if="me.admin">
                <label>E-Post</label>
                <input
                    name="epost"
                    v-model:value="edit.data.epost"
                    required=""
                    class="form-control">
            </div>
            <div class="form-group">
                <label>Telefon</label>
                <input 
                    name="telefon"
                    v-model:value="edit.data.telefon"
                    type="text"
                    required=""
                    class="form-control">
            </div>
            <!--<div class="form-group" v-if="me.admin">
                <label>Utdrag gilltigt till</label>
                <input 
                    name="utdrag_datum"
                    v-model:value="edit.data.utdrag_datum"
                    type="date"
                    required=""
                    class="form-control">
            </div>-->
            <div class="form-group" v-if="me.admin">
                <label>Kodstugor och Roller</label>
                <div v-for="(kodstugor_id, kodstugor_id_index) in edit.data.kodstugor_id" class="input-group">
                    <div class="input-group-prepend">
                        <select name="kodstugor_id" v-model:value="edit.data.kodstugor_id[kodstugor_id_index]" class="custom-select">
                            <option v-for="kodstuga in kodstugor" v-bind:value="kodstuga.id">{{kodstuga.namn}}</option>
                        </select>
                    </div>
                    <select name="roller" v-model:value="edit.data.roller[kodstugor_id_index]" class="custom-select">
                        <option value="volont√§r">Volont√§r</option>
                        <option value="√∂vervakare">√ñvervakare</option>
                    </select>
                </div>
                <button class="btn btn-secondary" type="button" v-on:click="edit.data.kodstugor_id.push('0'), edit.data.roller.push('volont√§r')">L√§gg till</button>
                <button class="btn btn-secondary" type="button" v-on:click="edit.data.kodstugor_id.pop(), edit.data.roller.pop()">Ta bort</button>
            </div>
            <div class="form-group">
                <button v-if="edit.data.id==''" type="submit" class="btn btn-primary">Spara som ny</button>
                <button v-else="" type="submit" class="btn btn-primary">Spara</button>
                <button v-on:click="edit=''" type="button" class="btn btn-secondary">Avbryt</button>
                <button v-on:click="radera_volont√§r(edit.data.id)" type="button" class="btn btn-danger" v-if="me.admin && edit.data.id!==''" >Radera</button>
            </div>
        </form>
    </div>
</div>